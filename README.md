# Markers Positions Detector
### _for Hangprinter's Computer Vision System_
<p align="justify">
  For those who are currently building Computer Vision System for their Hangprinters. I made a DLC to Tobben's work on auto calibration simulation for Hangprinter.<br><br>
  <b><i>Markers Positions Detector</i></b> is an independent program which detects markers placed on the Hangprinter's effector (or on the "mover") and calculates distances between them.<br><br>
  <b><i>Main goal of this detector is to automate and simplify process of obtaining markers positions.</i></b><br><br>
  As an output is XML file which is generated by program itself and it contains XYZ coordinates of each marker. This XML file is later used by 
  <i><a href=https://gitlab.com/tobben/hpm>hpm</a></i> program, but it's not necessary for using Markers Positions Detector.
</p>

## Preparations
<p align="justify">
  It is assumed that you have python installed on your computer. If you don't, follow instructions below.
</p>

```
sudo apt update
sudo apt install python3
```

<p align="justify">
  And check the version of your currently installed python.
</p>

```
python3 --version
```

<p align="justify"> 
  If you succeed, you can move on. Clone this repository with:
</p>

```
git clone https://github.com/matusbalazi/markers_positions_detector
```

<p align="justify">
  I recommend using PyCharm IDE, but also ordinary command line will work well.<br><br>
  You will also need to install the following packages: 
  <i><a href="https://github.com/opencv/opencv-python">opencv</a>, 
    <a href="https://github.com/numpy/numpy">numpy</a>, 
    <a href="https://github.com/scipy/scipy">scipy</a>, 
    <a href="https://github.com/uqfoundation/mystic">mystic</a>, 
    <a href="https://github.com/python-pillow/Pillow">pillow</a>, 
    <a href="https://github.com/tartley/colorama">colorama</a>.</i><br><br>
  If you have PyCharm IDE just hit <i>Alt+Enter</i> when your cursor is placed on the red underlined package and select <i>Install package</i>.<br><br>
  If you have only command line interface follow these commands:
</p>

```
sudo apt update

# install cv2 package
sudo apt install python3-opencv

# install numpy package
sudo apt install python3-pip
sudo pip install numpy

# install scipy package
sudo apt install python3-scipy

# install mystic package
sudo pip install mystic

# install PIL package
sudo pip install pillow

# install colorama package
sudo pip install colorama
```

<p align="justify">
  To run Markers Positions Detector program type to Terminal following:
</p>

```
python ./main.py
```

<p align="justify">
  or
</p>

```
python3 ./main.py
```

<p align="justify">
  There is a bunch of arguments you can add to speed up later process:
<ol>
  <li><i>-i</i> or <i>--image</i> means path to the input image</li>
  <li><i>-wi</i> or <i>--width</i> means width of the output image</li>
  <li><i>-he</i> or <i>--height</i> means height of the output image</li>
  <li><i>-c</i> or <i>--coords</i> means comma seperated list of source points to be transformed (write all this list in quotes)</li>
</ol>
  So the command to run Markers Positions Detector program can look like this:
</p>

```
python ./main.py --image input_images_examples/image3.jpg --width 1438 --height 1200 --coords "[(253,572),(870,214),(545,1073),(1162,715)]"
```

<p align="justify">
  You will also need some photo of your markers placed on the effector. You can take a photo with any camera. 
  I'm using same camera as Tobben (Arducam 8MP Sony IMX219 camera module with M2504ZH05 Arducam lens). 
  I recommend to reduce shutter time while taking a photo to avoid unwanted noise in the image.
  But out algorithm should work well with any value of shutter. If you have some kind of PiCam and you have installed correct version of 
  <a href="https://www.raspberrypi.com/documentation/accessories/camera.html">raspistill</a> which matches your lens you can take a photo by typing:
</p>

```
raspistill --quality 100 --timeout 300 --shutter 100000 --ISO 50 --width 3280 --height 2464
```

<p align="justify">
  Lower value of shutter makes brighter image, higher makes darker image.<br><br>
  The algorithm relies on the photo being taken from the location opposite to anchor B of Hangprinter to detect the markers in the correct order. 
  So that the user does not have to do anything. Otherwise if the photo is taken from another angle (from location opposite to anchor A or C) 
  you will have to rearrange calculated distances in the text file to correct order.<br><br>
  Markers should be detected in the order as shown in the image below.
</p>

## User Guide
